namespace LivePortfolio;

public class SharedSQL
{
	public const string ListPortfolios = "WITH AnnIncome AS (\r\n    SELECT D.Payment,\r\n           D.AssetId,\r\n           D.Amount,\r\n           T.PortfolioId,\r\n           SUM(T.Units) AS Units,\r\n           SUM(T.Units) * D.Amount AS Income\r\n      FROM Dividend D,\r\n           [Transaction] T\r\n     WHERE D.AssetId = T.AssetId AND \r\n           T.Date <= D.ExDividend\r\n           AND D.Exdividend <= Date('Now') \r\n           and D.Exdividend > Date('Now', '-1 Year')\r\n     GROUP BY D.Payment,\r\n              D.AssetId,\r\n              D.Amount,\r\n              T.PortfolioId\r\n     ORDER BY D.Payment DESC\r\n)\r\nSELECT P.Id,\r\n       P.Name,\r\n       P.Units,\r\n       P.Base_UnitPrice,\r\n       P.Date_Unitised,\r\n       P.cash,\r\n       COALESCE( (\r\n                     SELECT SUM(H.Holding * A.OfferPrice / 100) \r\n                       FROM Holding H,\r\n                            Asset A\r\n                      WHERE H.PortfolioId = P.Id AND \r\n                            H.AssetId = A.Id\r\n                 ), 0) AS Value,\r\n       (\r\n           SELECT SUM(Income)/100 \r\n             FROM AnnIncome AI\r\n            WHERE AI.PortfolioId = p.Id\r\n       )\r\n       AS Income\r\n  FROM Portfolio P\r\n ORDER BY P.Name;";

	public const string AllTransactions = "SELECT *\r\n  FROM (\r\n           SELECT D.Id,\r\n                  D.Payment AS Date,\r\n                  P.Name AS Portfolio,\r\n                  D.Ticker,\r\n                  'Dividend' AS Type,\r\n                  (SUM(T.Units) * D.Amount) / 100 AS Amount,\r\n                  SUM(T.Units) AS Units,\r\n                  0 AS UnitPrice,\r\n                  0 AS StampDuty,\r\n                  0 AS Commission,\r\n                  '' AS Remarks\r\n             FROM Dividend D,\r\n                  [Transaction] T,\r\n                  Portfolio P\r\n            WHERE D.AssetId = T.AssetId AND \r\n                  T.PortfolioId = P.Id AND \r\n                  T.Date <= D.ExDividend AND \r\n                  D.Payment <= Date('Now') \r\n            GROUP BY D.Payment,\r\n                     D.AssetId,\r\n                     D.Amount,\r\n                     T.PortfolioId\r\n           UNION\r\n           SELECT T.Id,\r\n                  T.Date,\r\n                  P.Name AS Portfolio,\r\n                  A.Ticker AS Ticker,\r\n                  T.Type,\r\n                  T.Units,\r\n                  T.Amount,\r\n                  T.UnitPrice,\r\n                  T.StampDuty,\r\n                  T.Commission,\r\n                  T.Remarks\r\n             FROM [Transaction] T\r\n                  JOIN\r\n                  Asset A ON A.Id = T.AssetId\r\n                  JOIN\r\n                  Portfolio P ON P.Id = T.PortfolioId\r\n       )\r\n  ORDER BY DATE DESC;";
}
